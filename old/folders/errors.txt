=============
Инициализация
=============

Обработка ошибок происходит через <функции>функцию "error" с указанием кода ошибки, которая перенаправляет на обработчик ошибок /errors/

Стандартный вызов:

{{ error('404', $template -> lang) }} - в модулях и вообще после инициализации шаблона
{{ error('404', $currlang) }} - в процессах и вообще до инициализации шаблона

Замена данной функции:

{{
	header($_SERVER['SERVER_PROTOCOL'] . ' ' . $code . ' FORBIDDEN', true, $code);
	header("Location: /index.php?error=" . $code . "&lang=" . $l);
	exit;
}}

Обработчик ошибок подгружается при необходимости в самом начале сайта, еще до инициализации функций, всяческих проверок и пр., чтобы максимально снизить нагрузку.

=========
Настройки
=========

Настройки задаются через файл [settings.ini] с данными в формате json.

	"mail" : "",
	"timer" : "10",
	"block" : {
		"en" : "1 hour",
		"ru" : "1 час"
	},
	"restore" : {
		"en" : "Access restore form",
		"ru" : "Форма восстановления доступа"
	},
	"support" : {
		"en" : "Contact to the support team: ",
		"ru" : "Обратиться в службу поддержки: "
	},
	"status" : {
		"en" : "Status",
		"ru" : "Статус"
	},
	"error" : {
		"en" : "Error",
		"ru" : "Ошибка"
	},
	"statuses" : ["mail", "201"],
	"errors" : ["400", "401", "403", "404", "500", "502", "504"],
	"langs" : ["en", "ru"]

=================
Описание настроек
=================

	"mail" - почтовый адрес тех.поддержки. Если не указан, то по-умолчанию будет выставлен "support@...", где ... - имя сайта (например, "site.com").
	
	"timer" - таймер обратного отсчета в секундах. Используется для возврата на предыдущую страницу. Инициализируется через чистый javascript, если в тексте ошибки была использована <переменные>текстовая переменная "{timer}".
	
	"block" - текстовое поле, зависимое от языка, выводится по <переменные>текстовой переменной "{block}". Используется для указания времени блокировки. Само время блокировки указывается в другом месте сайта, а здесь используется в качестве предупреждения, чтобы не исправлять в нескольких местах.
	
	"restore" - текстовое поле, зависимое от языка, выводится по <переменные>текстовой переменной "{restore}". Используется для названия формы восстановления доступа, чтобы не исправлять в нескольких местах.
	
	"support" - текстовое поле, зависимое от языка, выводится при вызове {{ $error -> support }} по <переменные>текстовой переменной "{support}". Выводится только ссылка на почтовый адрес тех.поддержки. Используется для названия призыва обратиться в службу поддержки, чтобы можно было использовать как отдельное поле в шаблоне.
	
	"status" - текстовое поле для статуса, зависимое от языка. Используется в шаблоне при вызове {{ $error -> name }}.
	
	"error" - текстовое поле для ошибки, зависимое от языка. Используется в шаблоне при вызове {{ $error -> name }}.
	
	"statuses" - список кодов ошибок в виде массива, для которых заголовком будет "статус".
	
	"errors" - список кодов ошибок в виде массива, для которых заголовком будет "ошибка".
	
	"langs" - список языков. Обязательно указание всех используемых в обработчике ошибок языков. Важно то, что если переданный язык не определен, то по-умолчанию будет использован первый язык в данном массиве.

============
Кастомизация
============

Обработчик ошибок является одним из <шаблон>системных шаблонов.

Коды и описания ошибок задаются через файл [errors.ini] с данными в формате json.

Пример:

	{
		...
		
		"400" : {
			"en" : {
				"description" : "Bad Request",
				"message" : "
					<p>You have been sent an invalid request. In order to continue working, go to the main page: {host}.</p>
					<p>You will automatically return to the previous page after {timer} seconds.</p>
					<p>Contact to the support team: {support}</p>
				"
			},
			"ru" : {
				"description" : "Неверный запрос",
				"message" : "
					<p>Вами был отправлен неверный запрос. Для того, чтобы продолжить работу, перейдите на главную страницу: {host}.</p>
					<p>Вы автоматически вернетесь на предыдущую страницу через {timer} секунд.</p>
					<p>Обратиться в службу поддержки: {support}</p>
				"
			}
		}
		
		...
	}

Массив содержит подмассивы, ключами для которых выступают коды ошибок.

В каждом подмассиве должно быть разделение по <языки>языкам. Хотя бы как минимум на один. Установленные языки обязательно указывать в [options.ini], в параметре "langs".

Для каждого языка есть два параметра: "description" (заголовок) и "message" (текст сообщения об ошибке).

В message могут быть использованы следующие <переменные>текстовые переменные:
	
	{timer} - вместо него будет выведен таймер обратного отсчета для возврата на предыдущую страницу, с которой поступил вызов
	{restore} - вместо него будет выведена ссылка на форму восстановления доступа к сайту в случае блокировки
	{host} - вместо него будет выведена ссылка на сайт
	{block} - вместо него будет выведен текст о периоде времени, на который блокируется доступ к сайту
	{support} - вместо него будет выведена ссылка на почтовый адрес тех.поддержки
	{phpversion} - вместо него будет выведена заданная минимальная версия php

======
Шаблон
======

Шаблон, как и все остальные, лежит в <шаблон>папке шаблонов и имеет название "errors".

Чтобы удобнее было работать с шаблоном, можно использовать следующие свойства объекта $error:

	code - код ошибки
	description - заголовок ошибки
	name - тип ошибки: статус или ошибка
	message - сообщение об ошибке
	support - поле с призывом обратиться в техподдержку и email-адресом
	path - путь к папке /errors/ для php, например для <функции>функций "require" или "file_exist"
	link - путь к папке /errors/ вида {{ "http://site.com/errors" }} для ссылок в шаблоне

Шаблон ошибок по-умолчанию подгружает файл стилей [style.css] и скриптов [script.js]. Однако его можно поменять и расширить под любую задачу.

Например, вы можете добавить новые стили, скрипты, шрифты и изображения.
