# Структура

## Общепринятые стандарты

## Общая схема

У нас есть три подхода к видению isEngine:

- архитектурный, через паттерн Модель-Вид-Контроллер,
- структурный, в виде постепенной реализации ООП,
- физический, через последовательную инициализацию.

### Архитектура

Архитектура использует паттерн Модель-Вид-Контроллер.

Модели задает библиотека isphp. Модели могут иметь разные варианты поведения, в зависимости от внешних факторов.

Контроллер - это ядро, которое управляет моделями на основе внешних факторов: параметров запроса и настроек системы.

Вид реализован шаблонами. Шаблоны работают с системой посредством модели вида.

Модель вида является прослойкой, обеспечивающей совместимость шаблонов с разными версиями библиотеки и ядра. Модель вида описана в моделях, настраивается в контроллере.

### Структура

На самом низком уровне находится сервер с интерпретатором языка PHP. Для управления сервером мы предлагаем свои настройки.

С сервером мы общаемся на языке PHP, используя его синтаксис и возможности. Но для построения isEngine мы создали хелперы - функции, расширяющие возможности языка.

Следующее звено - родительские классы. В основе классов лежит класс данных. Его наследуют все остальные классы. Часть классов также использует паттерн Синглтон. У них нет инстансов и они должны быть доступны из разных компонентов системы.

На базе родительских классов построены компоненты isEngine. Это полноценные классы, реализующие ту или иную модель.

Наравне с ними сделаны классы, названные Мастерами. По факту это интерфейсы, обеспечивающие взаимодействие с той или иной своей реализацией.

    Например, класс Exchange отвечает за обмен данными со сторонними сервисами. Он управляет классами группы Channels. В эту группу входит класс Email. Он реализует получение и отправку электронных писем.

    Также можно создать другие реализации. Например, обмен SMS, взаимодействие с соцсетями и мессенджерами.

Все эти классы составляют библиотеку.

На следующем уровне стоит ядро isEngine. Оно обрабатывает запрос с помощью всех описанных классов, формирует данные, и дальше передает эти данные интерфейсу.

Интерфейс находится на самом высоком уровне. Посредством него осуществляется взаимодействие пользователя с системой.

### Инициализация

Точкой входа в систему является индексный файл, расположенный в публичной папке проекта. Единственным его назначением является загрузка ядра isEngine.

Сначала ядро подключает необходимые библиотеки. Это делается через автозагрузку Composer'а, либо, в случае его отсутствия, средствами автозагрузки самого ядра.

После чего управление передается контроллеру.

На первом этапе ip-адрес запроса проверяется на блокировку. В случае, если данный ip-адрес запрещен, сеанс прерывается. Это сделано как можно раньше, чтобы снять лишнюю нагрузку с сервера, например, при DDOS-атаках.

Затем читается конфигурация системы, запускается логирование и обработка ошибок.

Дальше проверяется сессия. Обратите внимание, сессия не создается, а только проверяется. Если сессия устарела, происходит ее перезапуск. Благодаря настройкам, сессию можно обновлять для каждого запроса. Если же сессия была установлена как поддельная, она закрывается, после чего сеанс прерывается.

Следующим этапом идет определенение качества запроса. Здесь запрос проверяется по двум критериям: метод и источник запроса. Если оба запрещены, то такой запрос останавливает сеанс.

Только после этого идет дальнейшая инициализация. Сначала идет разбор адреса запроса. Затем - подключение к базе данных, чтение пользователя и определение языка.

После всего этого система переходит к двум возможным вариантам.

Первый - API.
Второй - запуск шаблона.

## Компоненты

## Связи и зависимости

## Регламент изменений
