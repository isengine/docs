# Структура

## Общепринятые стандарты

## Общая схема

У нас есть три подхода к видению isEngine:

- архитектурный, через паттерн Модель-Вид-Контроллер,
- структурный, в виде постепенной реализации ООП,
- физический, через последовательную инициализацию.

### Архитектура

Архитектура использует паттерн Модель-Вид-Контроллер.

Модели задает библиотека isphp. Модели могут иметь разные варианты поведения, в зависимости от внешних факторов.

Контроллер - это ядро, которое управляет моделями на основе внешних факторов: параметров запроса и настроек системы.

Вид реализован шаблонами. Шаблоны работают с системой посредством модели вида.

Модель вида является прослойкой, обеспечивающей совместимость шаблонов с разными версиями библиотеки и ядра. Модель вида описана в моделях, настраивается в контроллере.

### Структура

На самом низком уровне находится сервер с интерпретатором языка PHP. Для управления сервером мы предлагаем свои настройки.

С сервером мы общаемся на языке PHP, используя его синтаксис и возможности. Но для построения isEngine мы создали хелперы - функции, расширяющие возможности языка.

Следующее звено - родительские классы. В основе классов лежит класс данных. Его наследуют все остальные классы. Часть классов также использует паттерн Синглтон. У них нет инстансов и они должны быть доступны из разных компонентов системы.

На базе родительских классов построены компоненты isEngine. Это полноценные классы, реализующие ту или иную модель.

Наравне с ними сделаны классы, названные Мастерами. По факту это интерфейсы, обеспечивающие взаимодействие с той или иной своей реализацией.

> Например, класс Exchange отвечает за обмен данными со сторонними сервисами. Он управляет классами группы Channels. В эту группу входит класс Email. Он реализует получение и отправку электронных писем.

> Также можно создать другие реализации. Например, обмен SMS, взаимодействие с соцсетями и мессенджерами.

Все эти классы составляют библиотеку.

На следующем уровне стоит ядро isEngine. Оно обрабатывает запрос с помощью всех описанных классов, формирует данные, и дальше передает эти данные интерфейсу.

Интерфейс находится на самом высоком уровне. Посредством него осуществляется взаимодействие пользователя с системой.

### Инициализация

Точкой входа в систему является индексный файл, расположенный в публичной папке проекта. Единственным его назначением является загрузка ядра isEngine.

Сначала ядро подключает необходимые библиотеки. Это делается через автозагрузку Composer'а, либо, в случае его отсутствия, средствами автозагрузки самого ядра.

После чего управление передается контроллеру.

На первом этапе ip-адрес запроса проверяется на блокировку. В случае, если данный ip-адрес запрещен, сеанс прерывается. Это сделано как можно раньше, чтобы снять лишнюю нагрузку с сервера, например, при DDOS-атаках.

Затем читается конфигурация системы, запускается логирование и обработка ошибок.

Дальше проверяется сессия. Обратите внимание, сессия не создается, а только проверяется. Если сессия устарела, происходит ее перезапуск. Благодаря настройкам, сессию можно обновлять для каждого запроса. Если же сессия была установлена как поддельная, она закрывается, после чего сеанс прерывается.

Следующим этапом идет определенение качества запроса. Здесь запрос проверяется по двум критериям: метод и источник. Если оба запрещены, то такой запрос останавливает сеанс.

Дальше следует разбор адреса запроса. Затем - подключение к базе данных, авторизация пользователя и определение языка.

После всего этого инициализация считается завершенной и система переходит к исполнению одного из двух возможных вариантов.

- передача управления API,
- запуск вида.

В первом случае запрос передается на обработку API, в результате чего совершаются определенные действия и возвращается результат.

> Благодаря реализации API, isEngine можно использовать в качестве backend'а, который будет заниматься только обработкой входящих данных. При этом можно быть уверенным в безопасности, т.к. вся процедура инициализации повторяется для каждого запроса.

Во втором случае запускается шаблон и рендерится страница.

После выполнения этих задач сеанс прекращается.

## Компоненты

## Связи и зависимости

## Регламент изменений

В рамках развития isEngine гарантируется 100% совместимость внутри минорных версий. Это означает, что версии **1.0.10** и **1.0.11** будут полностью совместимы, даже если вы с версии **1.0.11** вернетесь на версию **1.0.10**.

Также гарантируется 100% обратная совместимость между минорными версиями. Т.е. при переходе с версии **1.0** на версию **1.1** все будет работать, как и раньше. Однако не факт, что при возврате на предыдущую версию все останется как прежде. В первую очередь, это зависит от того, что вы можете воспользоваться доработками, которые появились в новой версии, но которых нет в старой.

Мажорные версии, например, **2.0** и **1.0** подразумевают сильные отличия между собой. Тем не менее, мы собираемся поддерживать обратную совместимость между двумя соседними мажорными версиями. Это значит, что при переходе с версии **1.0** на версию **2.0** ваш проект останется рабочим. Однако для перехода на версию **3.0** вам скорее всего придется обновить кодовую базу проекта.

При переходе на мажорную версию, часть функций, классов и методов, может быть объявлена **deprecated** (устаревшими). Это означает, что их использование еще возможно в новой мажорной версии, но уже в следующей будет удалено.

С мажорными версиями также могут меняться системные требования, в частности, версия языка программирования, версия сервера, версия базы данных.

Максиальная совместимость обеспечивается рядом прослоек. Для разработчиков это в первую очередь хелперы и родительские классы. Для пользователей - модель представления.

Но мы также предполагаем развитие системы, при котором будут кардинально меняться ее архитектура и компоненты. Подобные изменения неизбежно приведут к отсутствии совместимости.

Об этом мы будем сообщать заранее, а также составлять необходимые инструкции по переходу на новую версию.
