# Map

## Описание

Модуль вывода карт.

На данный момент реализована поддержки следующих сервисов:

* yandex версии 2.1
* google версии 3.exp

## Техническая информация

Класс

	Map

В настройках по-умолчанию задана карта yandex.

В шаблоне идет вывод контейнера 'div' для карты по 'id' равному 'instance'.

Для этого контейнера через настройки можно указать классы, можно принудительно задать высоту и ширину.

Далее в шаблоне идет подключение блока на основе указанного сервиса и версии api. Эти блоки содержат скрипты с расширенными настройками по запуску и использованию всех функций.

Скрипты добавляются в буфер экстендера 'display':

	$view -> get('display') -> addBuffer('
		<script>
		...
		</script>
	');

Настройки позволяют одинаковым образом управлять разными сервисами карт. И сделать вывод разных карт универсальным.

## Настройки

**service**
Тип: **смешанный**
Возможные значения: **google**, **yandex**

Это поле определяет сервис карт. Используется исключительно с полем **api** для вызова блока скриптов.

**api**
Тип: **смешанный**
Возможные значения: **2.1**, **1.0**

Это поле определяет версию api для сервиса карт. Используется исключительно с полем **service** для вызова блока скриптов.

**key**
Тип: **смешанный**
Это поле задает ключ/токен. Его требуют сервисы карт для нормальной работы.

Если ключ не указан в настройках модуля, то вместо него будет подставлен ключ сервиса, указанный в настройках проекта.

Поле может быть оставлено пустым, но тогда не гарантируется нормальная работа сервисов.

**classes**
Тип: **смешанный**

Классы контейнера карты.

**width**
Тип: **смешанный**
Возможные значения: **"100px"**, **"100%"**, **"5vw"**, **"5rem"**

Принудительная ширина контейнера карты. Задается в стилях. Обязательно указывать единицы измерения.

**height**
Тип: **смешанный**
Возможные значения: **"100px"**, **"100%"**, **"5vh"**, **"5rem"**

Принудительная высота контейнера карты. Задается в стилях. Обязательно указывать единицы измерения.

**coordinates**
Тип: **смешанный**
Возможные значения: **["55.751426", "37.618879"]**

Координаты центра карты, заданные массивом.

Первое число соответствует lat, latitude, широте. Второе - lon, longitude, долготе.

**zoom**
Тип: **смешанный**
Возможные значения: **"1"**, **"16"**

Уровень приближения. Чем больше значение, тем более детально отображается карта.

**type**
Тип: **смешанный**
Возможные значения: **scheme**

Тип отображения карты. Если пропущен, то будет установлен в стандартное значение **scheme**.

Поддерживаются следующие типы:

* scheme - схема, также если тип отсутствует
* satellite - спутник
* hybrid - гибрид, спутник + схема
* map - схема, специальный тип только для яндекс
* terrain - схема, специальный тип только для гугл
* roadmap - схема, специальный тип только для гугл

**controls**
Тип: **смешанный**
Возможные значения: **[]**, **null**, **false**

Перечисление элементов управления на карте.

Если пропущено, то выбранный сервис сам установит стандартные для него элементы.

Если задан пустой массив, то с карты убираются все элементы.

Для **yandex** доступны следующие элементы:

* zoomControl - ползунок масштаба
* fullscreenControl - кнопка для перехода в полноэкранный режим
* geolocationControl - кнопка определить текущее положение
* searchControl - поиск
* routeButtonControl - панель маршрутизации
* rulerControl - линейка
* trafficControl - сервис пробки
* typeSelector - переключатель слоев

Для **google** доступны следующие элементы:

* zoomControl - ползунок масштаба
* fullscreenControl - кнопка для перехода в полноэкранный режим
* mapTypeControl - переключатель слоев
* scaleControl - изменение угла просмотра
* streetViewControl - просмотр улиц
* rotateControl - поворот

**marks**
Тип: **смешанный**

Раздел настроек, который управляет метками на карте.

Представляет из себя массив, содержащий объекты, описывающие каждую метку.

Пример:

	"marks" : [
		{
			...
		},
		{
			...
		}
	]

**position**
Тип: **смешанный**

Раздел настроек, который управляет текущей позицией пользователя на карте.

> На данный момент реализован только для сервиса yandex

Благодаря включению этой настройки, карта автоматически перемещается на предполагаемое место нахождения пользователя и там устанавливается метка, которую можно перемещать.

Пример:

	"position" : {
		"preset" : "darkGreenDotIcon",
		"selector" : {
			"lat" : ".module-maps-position .lat",
			"lon" : ".module-maps-position .lon",
			"address" : ".module-maps-position .address"
		}
	}

## Раздел marks

**coordinates**
Тип: **смешанный**

Координаты метки. Полностью аналогичны координатам центра карты.

Если не указаны, то будут взяты координаты центра карты.

**preset**
Тип: **смешанный**
Возможные значения: **dotIcon**, **circleIcon**, **circleDotIcon**

Пресет метки.

> Только для яндекс карт

> из списка https://tech.yandex.ru/maps/doc/jsapi/2.1/ref/reference/option.presetStorage-docpage/

**color**
Тип: **смешанный**
Возможные значения: **red**, **#ff0000**

Цвет метки. В виде названия цвета или rgb-кода.

> Только для яндекс карт

**image**
Тип: **смешанный**

Url-адрес кастомного изображения метки.

При указании, отменяет настройку **preset**.

**offset**
Тип: **смешанный**
Возможные значения: **{"width" : ..., "height" : ...}**

Смещение левого верхнего угла иконки относительно ее "ножки" (точки привязки).

Указывается числами, без единиц изменений. Устанавливается в пикселях.

Работает с настройкой **image**.

**hint**
Тип: **смешанный**
Возможные значения: **hint**

Надпись, появляющаяся при наведении на метку.

**header**
Тип: **смешанный**
Возможные значения: **заголовок**

Заголовок всплывающего окна при щелчке по метке.

**content**
Тип: **смешанный**
Возможные значения: **<p>содержимое</p>**

Содержимое всплывающего окна при щелчке по метке.

**footer**
Тип: **смешанный**
Возможные значения: **подвал или подпись**

Подвал всплывающего окна при щелчке по метке.

Для google карт, **header**, **content** и **footer** будут объединены в один общий контент со следующими классами:

	instance_header
	instance_content
	instance_footer

где instance соответствует значению **instance** модуля.

**autoopen**
Тип: **смешанный**
Возможные значения: **true**, **false**, **null**

Если вы хотите, чтобы всплывающее окно открывалось автоматически при загрузке карты.

**caption**
Тип: **смешанный**

Текст возле иконки.

> Только для яндекс карт

## Раздел position

**preset**
см. Раздел marks

**color**
см. Раздел marks

**image**
см. Раздел marks

**offset**
см. Раздел marks

**draggable**
Тип: **смешанный**
Возможные значения: **true**, **false**, **null**

Разрешает перетаскивание метки.

Если запрещено, то метка привязывается к центру карты, даже при перемещении по карте.

По-умолчанию запещено.

**selector**
Тип: **смешанный**

Подраздел в виде объекта:

	ключ : селектор

который управляет передачей координат метки в блоки, согласно заданным селекторам.

Список ключей:

* lat - координаты широты
* lon - координаты долготы
* common - координаты в виде 'широта:долгота'
* address - адрес точки в виде строки, полученный путем обратного геокодирования

Селекторы имеют стандартный вид 'css' селекторов. Например:

	".module-maps-position .lat"
