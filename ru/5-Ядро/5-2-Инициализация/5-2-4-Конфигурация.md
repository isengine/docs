# Конфигурация

Конфигурация isEngine задается в файле

	/config/configuration.ini

На самом деле, базовая конфигурация задана в самом ядре, а данный файл файл изменяет ее.

Если вы занимаетесь разработкой на локальной машине, вам наверняка понадобится изменить некоторые настройки. Для этого существует файл

	/config/configuration.local.ini

Он подключается только в том случае, если сервер имеет ip-адрес

	127.0.0.1

После того, как конфигурация прочитана, она записывается в системный компонент

	Config

и больше не может быть изменена.

## Структура файла

Конфигурационный файл представляет собой объект в формате **json**.

Если посмотреть на его содержимое, то можно увидеть, что все настройки разбиты по группам.

Например:

	"default" : {
	  "timezone" : "",
	  "scheme" : "",
	  "www" : false,
	  ...
	}

Вызов значения любой настройки осуществляется через компонент **Config**, например:

	namespace is;
	
	use is\Components\Config;
	
	$config = Config::getInstance();
	$config -> get('default:timezone');

Изменить существующее значение невозможно. Благодаря этому компонент **Config** по-сути является набором констант.

Давайте рассмотрим подробнее каждую группу настроек.

## Api

Группа **api** управляет конфигурацией API системы.

+ 'server' => null,
+ 'name' => 'api',
+ 'key' => 'key',
+ 'token' => 'token'

PROCESSOR - путь для процессора, по аналогии DEFAULT_ADMIN, это название точки входа для обработки системой процессов, если оставить пустой, то процессор фактически будет неактивен на сайте

## Db

Группа **db** отвечает за настройки базы данных.

 "driver" : "LocalDB",
 "host" : "localhost",
 "name" : "database",
 "user" : "root",
 "password" : "",
 "prefix" : "is",
 "port" : "",
 "cache" : null,
 "writing:user" : "",
 "writing:password" : ""

DB_TYPE - тип базы данных, в основном определяет драйвер для работы и некоторые правила, может иметь значения 'mysqli', 'mysqli-test' (с настройками для localhost), 'pdo' и 'nodb' или пустое значение для обращения к файлам

DB_HOST, DB_NAME, DB_PREFIX, DB_PORT, DB_USER, DB_PASS - настройки подключения к базе данных (для 'nodb' и пустого значения не учитываются, для 'mysqli-test' учитывается только поле DB_NAME)

DB_WRITINGUSER, DB_WRITINGPASS - пользователь с правами на запись в базу данных, работает только при включенной SECURE_WRITING

## Default

Группа **default** задает основные настройки системы.

+ "cache" : "1:hour",
+ "lang" : "ru",
+ "mode" : "develop",
+ "noindex" : true,
+ "template" : "light",
+ "timezone" : "",
+ "scheme" : "",
+ "www" : false

? "users" : true,
? "extension" : "html",
? "indexing" : true,

**CACHE** - установка кэширования.

Данная опция будет изменена, т.к. для кэширования планируется создать отдельную группу.

**LANG** - язык сайта по-умолчанию.

	если не задан, либо задан пустым или false, то языки в системе будут отключены
	если задан true, тогда будет браться автоматически из настроек вашего браузера или первый или единственный язык, найденный в системе
	любое другое значение будет принято как язык системы по-умолчанию
	* однако (!) если вы сменили язык сайта, он запишется в куки, либо в настройки пользователя, и затем будет браться уже оттуда
	* проверку языка лучше всего производить либо через спец. функцию (в шаблоне), либо через проверку, пустой или нет объект $lang

**MODE** - режим работы сайта. На данный момент, поддерживается не полностью.

	production или пустой - рабочий режим
	develop - режим разработки и отладки сайта
	test - режим, включающий службы тестирования, встроенные во фреймворк

**NOINDEX** - запретить индексацию сайта поисковыми системами. Возможные значения:

	true
	false

При включении, система будет генерировать файл **robots.txt** с запрещением индексации всех страниц сайта.

Будьте внимательны, включение этой опции запрещает индексирование, а не наоборот!

**TEMPLATE** - шаблон, используемый на сайте по-умолчанию. Например:

	default

**TIMEZONE** - временная зона в формате php. Например:

	America/Los_Angeles
	America/New_York
	Asia/Dubai
	Asia/Shanghai
	Europe/London
	Europe/Moscow
	и др...

**SCHEME** - схема по-умолчанию. Если указана, система будет осуществлять принудительный редирект на страницу именно с этой схемой. Например:

	http
	https

Если схема не задана, то система будет загружаться с той схемой, которая будет задана в браузере.

Такой редирект кажется удобнее, чем редирект на стороне сервера. Вам не придется изучать дополнительные правила, и его легко контролировать.

Чтобы редирект работал правильно и не уходил в бесконечный цикл, используйте рекомендуемые файлы для настройки сервера.

**WWW** - использование 'www.' в имени хоста по-умолчанию. Возможные значения:

	true
	false

При включении, система будет осуществлять принудительный редирект на страницу с 'www.' вначале. Например:

	site.com/page -> www.site.com/page

При выключении все будет наоборот:

	www.site.com/page -> site.com/page

Такой редирект кажется удобнее, чем редирект на стороне сервера. Вам не придется изучать дополнительные правила, и его легко контролировать.

Чтобы редирект работал правильно и не уходил в бесконечный цикл, используйте рекомендуемые файлы для настройки сервера.

USERS - включает поддержку пользователей на сайте

## Error

Группа **error** управляет обработкой и выводом ошибок.

+ 'url' => '/error/',
+ 'prefix' => '',
+ 'postfix' => '',
+ 'template' => 'error'
//'url' => '/',
//'prefix' => 'e',
//'postfix' => '.html'
//'url' => '/',
//'prefix' => '?error=',
//'postfix' => ''

ERRORS - путь для обработчика ошибок, одновременно является также названием шаблона вывода ошибок

## Log

Группа **log** управляет логированием событий и ошибок.

+ "mode" : "warning",
? "sort" : "name",
? "data" : true

SECURE_LOG - режим записи логов
* 'warning' - предупреждающий, например о плохих ошибках или опасных запросах
* 'panic' - панический, параноидальный или высокий, когда записываются все логи с подробной раскладкой, нужен для отлавливания ошибок, но крайне не рекомендуется в обычном режиме из-за большой нагрузки на файловую систему
* впоследствии возможно будет удален, а режимы перенесутся на константу DEFAULT_MODE

SECURE_SORTLOG - сортировка логов по папкам, 'ip', 'agent' - данные сервера, 'memory' - максимальный объем памяти, 'request', 'origin', 'admin' - константы, 'speed' - скорость загрузки, 'time', 'minute', 'hour', 'day', 'week', 'month' - временной промежуток, любое другое значение - папка с этим названием

## Path

Группа **path** отвечает за настройки путей к системным папкам. Вы можете задать пути в общей конфигурации, но рекомендуется задавать пути через отдельный файл

	/config/path.ini

+ "app" : "app",
+ "cache" : "cache",
+ "vendors" : "vendor",
+ "log" : "log",
+ "templates" : "templates"

PATH_SITE - путь к корневой папке сайта в файловой системе
PATH_BASE - путь до корневой папки в файловой системе, может быть использован, если вы хотите хранить некоторые данные снаружи и обращаться к ним

NAME_FOLDER, PATH_FOLDER, URL_FOLDER - группа констант, задающих имена и пути к системным папкам

## Router

Группа **router** позволяет гибко настроить правила роутинга. Будьте аккуратны, неправильное использование этих настроек может сделать систему частично или полностью неработоспособной.

+ 'folders:convert' => null,
+ 'folders:index' => null,
+ 'folders:extension' => null
+ 'files:convert' => null,
+ 'files:index' => null,
+ 'files:extension' => null
+ 'convert:from' => null,
+ 'convert:to' => null
+ 'index' => null,
+ 'reload' => true

## Secure

Группа **secure** управляет настройками системы, отвечающими за безопасность.

+ "request" : "get",
+ "referrer" : "blacklist",
+ "users" : true,
+ "rights" : true,
+ "sessiontime" : "60",
? "processtime" : "600",
+ "csrf" : true,
? "writing" : false

SECURE_REQUEST - разрешенные запросы, 'get', 'post', 'both', 'all' или 'disable', если ни один запрос не считается разрешенным, причем 'both' разрешает и get, и post-запросы, а 'all' разрешает любые запросы вообще

SECURE_BLOCKIP - блокировка пользователей по ip, 'blacklist', 'whitelist', 'developlist'

SECURE_USERS - более глубокая проверка пользователей, нужна для сайтов, на которых есть регистрация/авторизация, true если включена

SECURE_RIGHTS - включает проверку прав пользователей при запросах в базу данных

SECURE_SESSIONTIME - время жизни сессии в секундах, если задано то по нему будут определятся старые запросы

SECURE_PROCESSTIME - время жизни запроса в секундах, если задано то по нему будут определятся старые запросы

SECURE_CSRF - включает механизм защиты от CSRF-атак, кроме true (включен) и false (выключен) есть несколько предустановленных режимов: header - по заголовку, cookie - через куки, uid - с идентификатором пользователя
* работает только со включенными пользователями

SECURE_WRITING - ограничивает запись в базу данных путем авторизации пользователей с разными правами, true если включена
* на самом деле, логически запись в базу данных ограничивается через константу isWRITE, а физически - через двух пользователей с разными правами - только на чтение и на чтение/запись
* если у вас для работы с базой данных используется только один пользователь, включение этой функции приведет к ошибкам

Эти настройки влияют на безопасность системы

## System

Группа **system** задает основные системные настройки. Менять их крайне не рекомендуется. Это может привести к тому, что система частично или полностью окажется нерабочей.

+ 'php' => '5.6',
+ 'session' => 'SID',
+ 'charset' => 'UTF-8',
+ 'local' => '127.0.0.1',
? 'sender' => 'X-Mailer: PHP/' . phpversion()

**PHP** - минимальная версия php

**SESSION** - ключ идентификатора сессии

**CHARSET** - кодировка

**LOCAL** - адрес локального сервера

**SENDER** - идентификатор отправки e-mail сообщений средствами php

## Time

Группа **time** задает настройки времени. Они используются как служебная информация. Здесь время высчитано с точным расчетом вплоть до секунд. Менять их крайне не рекомендуется.

 'minute' => 60,
 'hour' => 3600,
 'day' => 86400,
 'week' => 604800,
 'month' => 2628000,
 'year' => 31556926

Есть еще константы времени, числовые значения в секундах:

TIME_MINUTE, TIME_HOUR, TIME_DAY, TIME_WEEK, TIME_MONTH, TIME_YEAR

Также они используются в обработчиках формата данных. Например:

'2:hour' будет переведено системой (в ряде случаев, только там где такая запись поддерживается) в '2 * TIME_HOUR' и затем вычислено абсолютное время в секундах.

## Url

Группа **url** расширяет правила разбора строки запроса.

+ 'assets' => '/assets/',
+ 'data:rest' => 'data',
+ 'data:query' => true

## Users

Группа **users** управляет пользователями - регистрацией, авторизацией и правами.

? "root" : "isengine",
? "password" : "$2y$10$EUpeNzmJ578HfanKAB9J6OvL5hFLvIWNwLDGu.ydCRYO9ROr5EDoS",
+ "email" : "nomail@isengine.org",
+ "rights" : false,
? "register" : "unconfirm:default"

ROOT_USER - используется при авторизации

ROOT_PASSWORD - используется при авторизации

Обе эти настройки можно назначить, если утерян доступ к управлению сайтом, иначе их лучше оставить пустыми. Имя должно быть уникальным, не повторять ни одно из имеющихся в базе данных. Пароль должен быть хэшем, сгенерированным с помощью функции password_hash.
Например, для простого пароля '123456' хэш будет таким '$2y$10$BI0X6u.4dYSkobhrLhBEzeO55zO1ST8IQmWBEhYvTG.IZTvFn6JWO'
Для сложного пароля, например 'c3~sfq0?o%EY' хэш будет таким '$2y$10$.rfhm2ehNQlKWXoOFfE/8eD21.AAQDaXN93dHOKLFwvIWI.AH1fVG'

EMAIL - адрес электронной почты, очень часто в небольших сайтах используется только одна почта, либо есть почта системного администратора так вот, если что система использует заданный здесь адрес

RIGHTS - задает права пользователей по-умолчанию (true - доступ разрешен, false - доступ запрещен), работает в том случае, если SECURE_RIGHTS = true и права пользователя для доступа к определенной базе данных не заданы
