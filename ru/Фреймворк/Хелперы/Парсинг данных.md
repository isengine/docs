# Парсинг данных

Пространство имен:

    use is/Helpers/Parser;

## Parser::textVariables

Parser::textVariables($string, $function, $start = '{', $end = '}')

Функция парсинга текстовых переменных.

**string**
Тип: **строка**
Строка, содержащая текстовую переменную

**function**
Тип: **callback-функция**
Функция-обработчик текстовой переменной

**start** и **end**
Тип: **строка**
Необязательные параметры, определяют символы начала и конца текстовой переменной

Текстовая переменная должна иметь вид

    {name|argument1:argument2:...}

* **name** - имя переменной
* **argument1:argument2:...** - аргументы

В зависимости от переменной, аргументов может быть разное количество.

Текстовая переменная может иметь многоуровневые вложения. Все они будут корректно обработаны в порядке очереди. Например:

    {var1|item1-1:{var2|{var3|item3-1:item3-2}}:item1-3}

Функция обработчик должна принимать первым аргуметом имя текстовой переменной, вторым - массив данных

По факту, этот хелпер - инструмент для реализации алгоритма разбора текстовых переменных.

## Parser::fromString

Parser::fromString($item = null, $parameters = [])

Функция парсинга системных данных в системный объект.

**item**
Тип: **строка**
Строка, представляющая собой системные данные

**parameters**
Тип: **системный объект**
Параметры преобразования

Параметры преобразования представляют собой массив значений

    [
      'key' => null,
      'clear' => null,
      'simple' => true
    ]

**key**
Тип: **смешанный**
Включает разбор данных по ключам

**clear**
Тип: **смешанный**
Включает удаление пустых значений из результата

**simple**
Тип: **смешанный**
Включает упрощенный режим

## Parser::toString

Parser::toString($item, $parameters = ['key' => null, 'clear' => null, 'simple' => null])

Функция обратного преобразования системного объекта в системные данные.

**item**
Тип: **системный объект**
Системный объект

**parameters**
Тип: **системный объект**
Параметры преобразования

Параметры преобразования представляют собой массив значений

    [
      'key' => null,
      'clear' => null,
      'simple' => true
    ]

**key**
Тип: **смешанный**
Задает ключи в качестве первых значений после разделителя

**clear**
Тип: **смешанный**
Включает удаление пустых значений из результата

**simple**
Тип: **смешанный**
Включает упрощенный режим

## Parser::fromJson

Parser::fromJson($data, $format = true)

Функция обработки данных в формате json.

**data**
Тип: **строка**
Строка в формате json

**format**
Тип: **смешанный**
Формат преобразования

Функция принимает данные и переводит их:

* в массив, если **format** задан **true**/**structure**/**content**
* в объект, если **format** задан **false** или не задан

## Parser::toJson

Parser::toJson($data, $format = null)

Функция перевода данных из системного объекта в формат json.

**data**
Тип: **системный объект**
Системный объект

**format**
Тип: **смешанный**
Включает форматирование с отступами и разбивкой по строкам.

Функция принимает массив данных и переводит в формат json. Символы unicode остаются как есть (не преобразуются в коды).

## Parser::prepare

Parser::prepare($data, $up = null)

Рекурсивная функция для специальной обработки массива. Необходима для работы парсера и в других случаях.

**data**
Тип: **системный объект**
Системный объект

**up**
Тип: **смешанный**
Задает ключ сокращения

Удаляет из результата ключи и значения по флагу **[!]**.

Если задан ключ сокращения, то заменяет текущее родительское значение дочерним значением с этим ключом.

Пример:

    $object = [
      'name' => 'first',
      'value' => [
        'en' => 'one',
        'ru' => '!один'
      ]
    ];
    $result = Parser::prepare($object);
    var_dump($result);

Результат:

    [
      'name' => 'first',
      'value' => [
        'en' => 'one'
      ]
    ]

Пример:

    $object = [
      'name' => 'first',
      '!value' => [
        'en' => 'one',
        'ru' => 'один'
      ]
    ];
    $result = Parser::prepare($object);
    var_dump($result);

Результат:

    [
      'name' => 'first'
    ]

Пример:

    $object = [
      'name' => 'first',
      'value' => [
        'en' => 'one',
        'ru' => 'один'
      ]
    ];
    $result = Parser::prepare($object, 'en');
    var_dump($result);
    
Результат:

    [
      'name' => 'first'
      'value' => 'one'
    ]
