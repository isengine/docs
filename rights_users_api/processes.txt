Препроцессор - это предварительный обработчик процессов, который занимается проверкой входящих данных и их перераспределением

Препроцессор называется 'preprocessor.php'

В файле 'processor.ini' перечисляются зарегистрированные в системе процессы и их обработчики (процессоры)

Например, для query=restore будет определен процесс "restore" и вызван обработчик "user"

Если будет вызван процесс, отсутствующий в списке или будет отсутствовать файл обработки процесса, то сайт вернет ошибку 400: неверный запрос

Пример структуры файла:

{
	"user" : ["restore", "activation", "deactivation"],
	"forms" : ["logout", "login", "registration", "editprofile", "changeavatar", "deleteavatar"],
	"projects" : ["createproject", "deleteproject", "openproject", "closeproject", "lockproject"],
	"editor" : ["savecard", "updatecard", "searchcard", "refreshcard", "saveboard"],
	"payment" : ["payment"]
}

Таким образом, в системе разрешены только запросы через $_GET['query'] или $_POST['query']

Стандартными параметрами являются статус $_GET/POST['status'] и данные или массив данных $_GET/POST['data']

Все эти данные будут собраны препроцессором в одну переменную $query со следующей структурой:
	name // имя запроса, так же название процесса
	param // параметр запроса, чаще всего это параметр модуля, с которым он был вызван
	status // статус запроса, например для платежа это может быть fail - ошибка и success - успешно
	hash // хэш запроса, собственно это время, закриптованное базовой функцией для проверки времени запроса
		// если время запроса было более 10 минут назад, то запрос считается устаревшим и препроцессор выдаст страницу ошибки
		// для тестирования запросов можно использовать фейковый запрос, состоящий из 10 знаков, которые не составляют число, и символа '=' вначале, например '=123456789a' или '=qwertyuiop'
	data // массив сопутствующих данных
	open // адрес вызываемого процессора
	method // метод передачи данных - post или get, причем всегда маленькими буквами, т.к. при получении, значение метода конвертируется в маленькие буквы
	errors // массив, содержащий ошибки
	var // массив переменных, необходимых для обработки данных процессором
		// по окончании обработки он чистится, так что если нужно сохранить какие-либо данные, передавайте их либо через data, либо через errors

Базовый шаблон модуля форм формирует правильный запрос с хэшем и всеми данными

Данные из строки в любом случае преобразуются в массив с ключом 'default': ...&data=text >>>>>>>> $query -> data['default'] => 'text'
Чтобы передать массив данных, например ['id' => 1, 'name' => 'user', 'type' => 'description'] он должен выглядеть так: ...&data[id]=1&data[name]=user&data[type]=description

Что еще важно - name и status подвергаются обработке и по-сути являются безопасными. Однако data обработке не подвергается, и может содержать в себе все, что угодно.
Поэтому в процессоре важно будет обрабатывать получаемые данные, сравнивать их с допустимыми и отбрасывать лишние

Процессор - вызываемый обработчик того или иного события (процесса), например, регистрации или авторизации пользователя, отправки сообщений и т.п.

Обшие процессы собраны в одну группу и ими по-сути должен заниматься один процессор. Но на данный момент это не так.
В этой версии процессор, грубо говоря, представляет собой название папки, в которой содержится набор процессоров, каждый из которых заточен только под одно событие

Введение переменной $query позволяет упорядочить поток входящих данных и в дальнейшем стандартизировать и укрепить систему процессов



Для работы с модулями была введена приоритетная проверка процессов.

Это сделано для того, чтобы во-первых, изолировать процессы модуля от процессов системы.
А во-вторых, если злоумышленник попывается взломать системный процесс через модуль, то ему будет до него труднее добраться.
Аргумент, конечно, слабый, но тем не менее он есть.

Как работает приоритет. Все просто - если $query -> name соответствует названию модуля, а также если в модуле есть файл
обработчика query.php, то препроцессор переключает обработку на него.



Формы, соответственно, должны выглядеть так:

<form method="post" id="form"> // или get - неважно
								// идентификатор формы необходимо указывать, если вы хотите связать с этой формой вынесенные за ее пределы элементы
								// например, тэг button после закрытия формы
	<input type="hidden" name="query" value="process"> // здесь в value указать название процесса или модуля
	
	<input type="text" name="data[...]" value="..."> // дальше идут строки формы, где любые данные передаются через массив data, иначе они просто не будут учтены
	...
	
	<input type="submit" value="submit"> // кнопка отправки данных на сервер
	<button type="submit">button name</button> // или так
	<button type="submit" name="data[...]">button name</button> // если добавить атрибут name, то с помощью этой кнопки можно также передать еще одни данные
</form>

<input type="text" form="form" name="data[...]" value="..."> // данные из этого поля также будут отправлены на сервер, т.к. поле связано через атрибут form с id формы
<button type="submit" form="form">button name</button> // эта кнопка также отправит данные формы на сервер, т.к. она связана через атрибут form с id формы
